@{
    ViewData["Title"] = "Analytics Dashboard";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    /* ===== Dashboard Styling Enhancements ===== */
    .dashboard-title {
        font-weight: 700;
        font-size: 2rem;
        color: #293042;
        margin-bottom: 1.5rem;
    }

    .card.widget-flat {
        border: none;
        border-radius: 20px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
        background: linear-gradient(135deg, #f9fafc, #eef2f7);
    }

    .card.widget-flat:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }

    .card.widget-flat h3 {
        font-weight: 800;
        color: #2d2f36;
    }

    .card-header {
        background: transparent;
        border-bottom: none;
        font-weight: 600;
    }

    canvas {
        max-height: 280px !important;
    }

    /* Gradient Badges */
    .gradient-badge {
        background: linear-gradient(135deg, #727cf5, #39afd1);
        color: white;
        font-weight: 600;
        padding: 0.35rem 0.75rem;
        border-radius: 0.5rem;
    }

    /* Table Styling */
    table {
        border-radius: 12px;
        overflow: hidden;
    }

    table thead {
        background: #727cf5;
        color: white;
    }

    #expiringInsuranceTable tr:hover {
        background: rgba(114,124,245,0.1);
    }

    /* Chart Container Shadows */
    .chart-card {
        border-radius: 20px;
        box-shadow: 0 8px 25px rgba(114,124,245,0.15);
        border: none;
    }
</style>

<div class="container-fluid py-4">

    <h2 class="dashboard-title"><i class="uil uil-chart-line me-2"></i> Analytics Overview</h2>

    <!-- 1️⃣ Summary Cards -->
    <div class="row mb-4">
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card widget-flat text-center">
                <div class="card-body">
                    <i class="uil uil-users-alt display-5 text-primary mb-2"></i>
                    <h6 class="text-muted mt-0">Total Patients</h6>
                    <h3 id="totalPatients" class="mt-2 fw-bold">0</h3>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card widget-flat text-center">
                <div class="card-body">
                    <i class="uil uil-user-md display-5 text-info mb-2"></i>
                    <h6 class="text-muted mt-0">Total Doctors</h6>
                    <h3 id="totalDoctors" class="mt-2 fw-bold">0</h3>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card widget-flat text-center">
                <div class="card-body">
                    <i class="uil uil-calendar-alt display-5 text-success mb-2"></i>
                    <h6 class="text-muted mt-0">Appointments</h6>
                    <h3 id="totalAppointments" class="mt-2 fw-bold">0</h3>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card widget-flat text-center">
                <div class="card-body">
                    <i class="uil uil-building display-5 text-warning mb-2"></i>
                    <h6 class="text-muted mt-0">Departments</h6>
                    <h3 id="totalDepartments" class="mt-2 fw-bold">0</h3>
                </div>
            </div>
        </div>
    </div>

    <!-- 2️⃣ Charts Row -->
    <div class="row">
        <div class="col-xl-6 mb-4">
            <div class="card chart-card">
                <div class="card-header">
                    <h5 class="text-dark"><i class="uil uil-chart-growth me-1"></i>Appointments Over Time</h5>
                </div>
                <div class="card-body">
                    <canvas id="appointmentsChart"></canvas>
                </div>
            </div>
        </div>
        <div class="col-xl-6 mb-4">
            <div class="card chart-card">
                <div class="card-header">
                    <h5 class="text-dark"><i class="uil uil-users-alt me-1"></i>Patient Registrations Over Time</h5>
                </div>
                <div class="card-body">
                    <canvas id="patientsChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- 3️⃣ Distribution Charts -->
    <div class="row">
        <div class="col-xl-6 mb-4">
            <div class="card chart-card">
                <div class="card-header">
                    <h5 class="text-dark"><i class="uil uil-chart-pie-alt me-1"></i>Department-wise Doctor Distribution</h5>
                </div>
                <div class="card-body">
                    <canvas id="departmentChart"></canvas>
                </div>
            </div>
        </div>
        <div class="col-xl-6 mb-4">
            <div class="card chart-card">
                <div class="card-header">
                    <h5 class="text-dark"><i class="uil uil-male-female me-1"></i>Gender Distribution</h5>
                </div>
                <div class="card-body">
                    <canvas id="genderChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- 4️⃣ Top Doctors + Expiring Insurance -->
    <div class="row">
        <div class="col-xl-6 mb-4">
            <div class="card">
                <div class="card-header">
                    <h5><i class="uil uil-trophy me-1"></i>Top Doctors by Appointments</h5>
                </div>
                <div class="card-body" style="max-height: 320px; overflow-y: auto;">
                    <ul id="topDoctorsList" class="list-group list-group-flush"></ul>
                </div>
            </div>
        </div>

        <div class="col-xl-6 mb-4">
            <div class="card">
                <div class="card-header d-flex justify-content-between">
                    <h5><i class="uil uil-shield-exclamation me-1"></i>Expiring Insurance (Next 30 Days)</h5>
                    <span class="gradient-badge" id="expiringSoonCount">0</span>
                </div>
                <div class="card-body" style="max-height: 320px; overflow-y: auto;">
                    <table class="table table-striped table-sm">
                        <thead>
                            <tr>
                                <th>Patient</th>
                                <th>Provider</th>
                                <th>Policy</th>
                                <th>End Date</th>
                            </tr>
                        </thead>
                        <tbody id="expiringInsuranceTable"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Doctor Feedback Ratings & Ward Utilization -->
    <div class="row g-4 mt-3">
        <!-- Doctor Feedback Ratings -->
        <div class="col-xl-6 col-lg-6">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-gradient text-white d-flex align-items-center"
                     style="background: linear-gradient(135deg, #28a745, #56d18c); border-top-left-radius: .75rem; border-top-right-radius: .75rem;">
                    <i class="bi bi-star-fill me-2 fs-5"></i>
                    <h5 class="mb-0 fw-semibold">Doctor Feedback Ratings</h5>
                </div>
                <div class="card-body p-4">
                    <canvas id="feedbackChart" height="140"></canvas>
                </div>
            </div>
        </div>

        <!-- Ward Utilization -->
        <div class="col-xl-6 col-lg-6">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-gradient text-white d-flex align-items-center"
                     style="background: linear-gradient(135deg, #6f42c1, #a375ff); border-top-left-radius: .75rem; border-top-right-radius: .75rem;">
                    <i class="bi bi-hospital-fill me-2 fs-5"></i>
                    <h5 class="mb-0 fw-semibold">Ward Utilization</h5>
                </div>
                <div class="card-body p-4">
                    <canvas id="wardChart" height="140"></canvas>
                </div>
            </div>
        </div>
    </div>



</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="~/js/Analytics/analytics.js"></script>
}
